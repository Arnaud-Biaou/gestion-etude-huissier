<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Releve de Compte - {{ proprietaire }}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; font-size: 10pt; line-height: 1.5; padding: 20mm; }
        .header { text-align: center; margin-bottom: 25px; border-bottom: 2px solid #333; padding-bottom: 15px; }
        .header h1 { font-size: 18pt; margin-bottom: 5px; }
        .header h2 { font-size: 11pt; color: #666; font-weight: normal; }
        .meta { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 9pt; color: #666; }
        h2.title { text-align: center; margin-bottom: 25px; font-size: 14pt; text-transform: uppercase; }
        .proprietaire-info { background: #f8f9fa; padding: 15px; margin-bottom: 20px; border-radius: 4px; }
        .proprietaire-info h3 { font-size: 12pt; margin-bottom: 10px; color: #333; }
        .info-grid { display: grid; grid-template-columns: 120px 1fr; gap: 5px; font-size: 10pt; }
        .info-label { color: #666; }
        .periode { text-align: center; margin-bottom: 20px; padding: 10px; background: #e8f4f8; border-radius: 4px; }
        .periode strong { font-size: 11pt; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px 6px; text-align: left; }
        th { background-color: #f5f5f5; font-weight: bold; font-size: 9pt; text-transform: uppercase; }
        td { font-size: 9pt; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .montant-positif { color: #065f46; font-weight: bold; }
        .montant-negatif { color: #991b1b; font-weight: bold; }
        .totaux { background: #f5f5f5; margin-top: 20px; padding: 15px; border-radius: 4px; }
        .totaux-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .total-item { text-align: center; padding: 10px; background: white; border-radius: 4px; }
        .total-value { font-size: 14pt; font-weight: bold; }
        .total-value.positif { color: #065f46; }
        .total-value.negatif { color: #991b1b; }
        .total-label { font-size: 9pt; color: #666; text-transform: uppercase; margin-top: 5px; }
        .solde-box { text-align: center; margin-top: 20px; padding: 20px; border: 2px solid #065f46; border-radius: 4px; }
        .solde-label { font-size: 10pt; color: #666; margin-bottom: 5px; }
        .solde-value { font-size: 20pt; font-weight: bold; color: #065f46; }
        .biens-section { margin-top: 25px; }
        .biens-section h3 { font-size: 11pt; margin-bottom: 10px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        .bien-item { padding: 10px; margin-bottom: 10px; background: #f8f9fa; border-radius: 4px; }
        .bien-header { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .bien-name { font-weight: bold; }
        .bien-status { font-size: 8pt; padding: 2px 8px; border-radius: 3px; }
        .status-loue { background: #d1fae5; color: #065f46; }
        .status-libre { background: #fef3c7; color: #92400e; }
        .footer { margin-top: 40px; text-align: center; font-size: 8pt; color: #999; border-top: 1px solid #ddd; padding-top: 15px; }
        @media print {
            body { padding: 10mm; }
            .no-print { display: none; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ETUDE BIAOU</h1>
        <h2>Huissier de Justice</h2>
    </div>

    <div class="meta">
        <span>Date d'edition: {% now "d/m/Y H:i" %}</span>
        <span>Reference: REL-{{ proprietaire.id|slice:":8"|upper }}</span>
    </div>

    <h2 class="title">Releve de Compte Proprietaire</h2>

    <!-- Informations proprietaire -->
    <div class="proprietaire-info">
        <h3>{{ proprietaire }}</h3>
        <div class="info-grid">
            <span class="info-label">Adresse:</span>
            <span>{{ proprietaire.adresse }}, {{ proprietaire.ville }}</span>
            <span class="info-label">Telephone:</span>
            <span>{{ proprietaire.telephone }}</span>
            <span class="info-label">Email:</span>
            <span>{{ proprietaire.email|default:"-" }}</span>
        </div>
    </div>

    <!-- Periode -->
    <div class="periode">
        <strong>Periode: {{ periode_debut|date:"d/m/Y" }} - {{ periode_fin|date:"d/m/Y" }}</strong>
    </div>

    <!-- Tableau des mouvements -->
    <h3 style="margin-bottom: 10px; font-size: 11pt;">Mouvements de la Periode</h3>
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Bien</th>
                <th>Locataire</th>
                <th class="text-right">Encaissements</th>
                <th class="text-right">Reversements</th>
            </tr>
        </thead>
        <tbody>
            {% for mouvement in mouvements %}
            <tr>
                <td>{{ mouvement.date|date:"d/m/Y" }}</td>
                <td>{{ mouvement.description }}</td>
                <td>{{ mouvement.bien|default:"-" }}</td>
                <td>{{ mouvement.locataire|default:"-" }}</td>
                <td class="text-right">
                    {% if mouvement.type == 'encaissement' %}
                    <span class="montant-positif">{{ mouvement.montant|floatformat:0 }} XOF</span>
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td class="text-right">
                    {% if mouvement.type == 'reversement' %}
                    <span class="montant-negatif">{{ mouvement.montant|floatformat:0 }} XOF</span>
                    {% else %}
                    -
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center">Aucun mouvement sur la periode</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Totaux -->
    <div class="totaux">
        <div class="totaux-grid">
            <div class="total-item">
                <div class="total-value positif">{{ total_encaissements|floatformat:0|default:0 }} XOF</div>
                <div class="total-label">Total Encaissements</div>
            </div>
            <div class="total-item">
                <div class="total-value negatif">{{ total_reversements|floatformat:0|default:0 }} XOF</div>
                <div class="total-label">Total Reversements</div>
            </div>
            <div class="total-item">
                <div class="total-value">{{ commission_agence|floatformat:0|default:0 }} XOF</div>
                <div class="total-label">Commission Agence</div>
            </div>
        </div>
    </div>

    <!-- Solde -->
    <div class="solde-box">
        <div class="solde-label">Solde a Reverser</div>
        <div class="solde-value">{{ solde_a_reverser|floatformat:0|default:0 }} XOF</div>
    </div>

    <!-- Biens du proprietaire -->
    <div class="biens-section">
        <h3>Biens du Proprietaire</h3>
        {% for bien in biens %}
        <div class="bien-item">
            <div class="bien-header">
                <span class="bien-name">{{ bien.designation }}</span>
                <span class="bien-status {% if bien.statut == 'LOUE' %}status-loue{% else %}status-libre{% endif %}">
                    {{ bien.get_statut_display }}
                </span>
            </div>
            <div style="font-size: 9pt; color: #666;">
                {{ bien.adresse }}, {{ bien.ville }} - Loyer: {{ bien.loyer_reference|floatformat:0|default:"-" }} XOF
            </div>
        </div>
        {% empty %}
        <p style="color: #666; font-style: italic;">Aucun bien enregistre</p>
        {% endfor %}
    </div>

    <div class="footer">
        <p>Ce releve est un document informatif. Pour toute reclamation, veuillez contacter l'etude.</p>
        <p>Etude BIAOU - Huissier de Justice</p>
    </div>

    <script>window.print();</script>
</body>
</html>
