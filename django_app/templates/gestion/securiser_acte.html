{% extends "base.html" %}

{% block title %}Sécuriser un Acte - {{ dossier.reference }}{% endblock %}

{% block content %}
<div class="page-header">
    <div class="breadcrumb">
        <a href="{% url 'gestion:dossiers' %}">Dossiers</a>
        <span>/</span>
        <a href="{% url 'gestion:dossier_detail' dossier.id %}">{{ dossier.reference }}</a>
        <span>/</span>
        <span>Sécuriser un acte</span>
    </div>
    <h1>Sécuriser un Acte avec QR Code</h1>
    <p style="color: var(--neutral-600);">
        Uploadez votre PDF et le QR code de vérification sera automatiquement incrusté sur le document.
    </p>
</div>

<div class="card" style="max-width: 700px;">
    <div class="card-header">
        <h2>Informations de l'acte</h2>
    </div>
    <div class="card-body">
        <form method="POST" action="" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="form-group" style="margin-bottom: 20px;">
                <label for="type_acte" class="form-label">Type d'acte *</label>
                <select name="type_acte" id="type_acte" class="form-control" required>
                    <option value="">-- Sélectionnez --</option>
                    {% for value, label in types_acte %}
                    <option value="{{ value }}">{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
                <label for="titre_acte" class="form-label">Titre de l'acte *</label>
                <input type="text"
                       name="titre_acte"
                       id="titre_acte"
                       class="form-control"
                       placeholder="Ex: Signification de jugement, PV de constat, Commandement de payer..."
                       required>
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
                <label for="date_acte" class="form-label">Date de l'acte *</label>
                <input type="date"
                       name="date_acte"
                       id="date_acte"
                       class="form-control"
                       value="{% now 'Y-m-d' %}"
                       required>
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
                <label for="parties_resume" class="form-label">Parties concernées *</label>
                <input type="text"
                       name="parties_resume"
                       id="parties_resume"
                       class="form-control"
                       value="{{ parties_default }}"
                       placeholder="Ex: BANQUE XYZ c/ M. DUPONT Jean"
                       required>
            </div>

            <!-- Upload PDF -->
            <div class="form-group" style="margin-bottom: 20px;">
                <label for="pdf_acte" class="form-label">Document PDF de l'acte</label>
                <input type="file"
                       name="pdf_acte"
                       id="pdf_acte"
                       class="form-control"
                       accept=".pdf"
                       style="padding: 10px;">
                <small style="color: var(--neutral-500);">
                    Le QR code sera automatiquement incrusté sur la dernière page du PDF.
                    Si aucun PDF n'est fourni, seul le code de vérification sera généré.
                </small>
            </div>

            <!-- Position du QR -->
            <div class="form-group" style="margin-bottom: 20px;">
                <label class="form-label">Position du QR code</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px; border: 1px solid var(--neutral-200); border-radius: 6px;">
                        <input type="radio" name="position_qr" value="bottom-right" checked>
                        <span>Bas droite (recommandé)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px; border: 1px solid var(--neutral-200); border-radius: 6px;">
                        <input type="radio" name="position_qr" value="bottom-left">
                        <span>Bas gauche</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px; border: 1px solid var(--neutral-200); border-radius: 6px;">
                        <input type="radio" name="position_qr" value="top-right">
                        <span>Haut droite</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px; border: 1px solid var(--neutral-200); border-radius: 6px;">
                        <input type="radio" name="position_qr" value="top-left">
                        <span>Haut gauche</span>
                    </label>
                </div>
            </div>

            <div style="background: var(--info-bg, #e7f3ff); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                <p style="font-size: 0.875rem; color: var(--info-text, #0066cc); margin: 0;">
                    <strong>Comment ça fonctionne</strong><br>
                    1. Uploadez votre PDF d'acte<br>
                    2. Le système génère un code de vérification unique<br>
                    3. Le QR code est automatiquement incrusté sur le PDF<br>
                    4. Téléchargez les versions : <strong>Original</strong>, <strong>Second Original</strong>, <strong>Copie</strong>
                </p>
            </div>

            <div style="display: flex; gap: 12px; justify-content: flex-end;">
                <a href="{% url 'gestion:dossier_detail' dossier.id %}" class="btn btn-secondary">
                    Annuler
                </a>
                <button type="submit" class="btn btn-primary">
                    <i data-lucide="shield-check"></i> Sécuriser l'acte
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
